<!DOCTYPE html>
<html lang="fr">
<head>
  <title>Tableau de bord — BankDemo</title>
  <%- include('partials/head') %>
</head>
<body>

<div class="layout">

  <%- include('partials/navbar', { activePage: 'dashboard' }) %>

  <!-- ══════════ MAIN ══════════ -->
  <div class="main">

    <!-- Top bar -->
    <header class="topbar">
      <div style="display:flex; align-items:center; gap:16px;">
        <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="2" y1="5" x2="18" y2="5"/>
            <line x1="2" y1="10" x2="18" y2="10"/>
            <line x1="2" y1="15" x2="18" y2="15"/>
          </svg>
        </button>
        <div class="topbar-left">
          <h1>Tableau de bord</h1>
          <p>Bienvenue, <strong style="color:var(--gold-light);font-weight:400;">
            <%= typeof user !== 'undefined' && user ? user.email.split('@')[0] : 'Client' %>
          </strong></p>
        </div>
      </div>
      <div class="topbar-right">
        <span class="topbar-date" id="currentDate"></span>
        <button class="notification-btn" aria-label="Notifications">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
            <path d="M8 1a5 5 0 0 1 5 5v3l1.5 2H1.5L3 9V6a5 5 0 0 1 5-5Z"/>
            <path d="M6.5 13a1.5 1.5 0 0 0 3 0"/>
          </svg>
          <span class="notification-dot"></span>
        </button>
      </div>
    </header>

    <!-- Page body -->
    <div class="page-body">

      <!-- ── BALANCE SECTION ── -->
      <div class="balance-section">

        <!-- Main balance card -->
        <div class="balance-card main-card">
          <p class="card-label">Solde disponible</p>
          <div class="card-balance">
            <span class="currency">MAD</span>
            <span class="count-up" data-target="<%= account.balance %>">
              <%= parseFloat(account.balance).toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
            </span>
          </div>
          <div class="card-meta">
            <span class="dot"></span>
            Compte actif &nbsp;·&nbsp; Mis à jour à l'instant
          </div>
          <div class="account-number">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.2" style="color:var(--text-dim)">
              <rect x="1" y="3" width="12" height="8" rx="1"/>
              <path d="M1 6h12"/>
              <path d="M4 9h2"/>
            </svg>
            <span>N° de compte</span>
            <strong>BD-<%= String(account.account_id || '0000').padStart(6,'0') %></strong>
          </div>
        </div>

        <!-- Stat: Credits -->
        <div class="balance-card stat-card">
          <div class="stat-icon green">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.4">
              <path d="M9 15V3M3 9l6-6 6 6"/>
            </svg>
          </div>
          <div class="stat-label">Crédits du mois</div>
          <div class="stat-value">3 000 <small style="font-size:16px;color:var(--text-dim)">MAD</small></div>
          <span class="stat-trend up">↑ Salaire reçu</span>
        </div>

      </div>

      <!-- ── QUICK ACTIONS ── -->
      <div class="section-header">
        <h2 class="section-title">Actions rapides</h2>
      </div>

      <div class="actions-grid">
        <a href="/transfer" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <path d="M2 6h12M11 2l4 4-4 4"/>
              <path d="M18 14H6M9 18l-4-4 4-4"/>
            </svg>
          </div>
          <span class="action-label">Virement</span>
        </a>

        <a href="/transactions" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <rect x="2" y="3" width="16" height="14" rx="2"/>
              <path d="M2 7h16M6 11h3M6 14h2"/>
            </svg>
          </div>
          <span class="action-label">Historique</span>
        </a>

        <a href="/messages" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <rect x="2" y="3" width="16" height="12" rx="2"/>
              <path d="M2 7l8 5 8-5"/>
            </svg>
          </div>
          <span class="action-label">Messages</span>
        </a>

        <a href="/logout" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <path d="M8 3H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h3"/>
              <path d="M14 14l4-4-4-4"/>
              <line x1="18" y1="10" x2="8" y2="10"/>
            </svg>
          </div>
          <span class="action-label">Déconnexion</span>
        </a>
      </div>

      <!-- ── BOTTOM GRID ── -->
      <div class="bottom-grid">

        <!-- Transactions récentes -->
        <div class="card-panel">
          <div class="card-panel-head">
            <h3 class="section-title" style="font-size:17px;">Dernières transactions</h3>
            <a href="/transactions" class="section-link">
              Voir tout
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M2 6h8M7 3l3 3-3 3"/>
              </svg>
            </a>
          </div>

          <table class="tx-table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Bénéficiaire</th>
                <th style="text-align:right;">Montant</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="txBody">
              <!-- Populated by JS with sample data -->
            </tbody>
          </table>
        </div>

        <!-- Right column -->
        <div class="right-col">

          <!-- Aperçu du solde -->
          <div class="card-panel">
            <div class="card-panel-head">
              <h3 class="section-title" style="font-size:17px;">Aperçu du solde</h3>
            </div>
            <div class="progress-item">
              <div class="progress-top">
                <span>Épargne mensuelle</span>
                <span>68%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:68%"></div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-top">
                <span>Dépenses courantes</span>
                <span>32%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:32%;background:var(--red)"></div>
              </div>
            </div>
          </div>

          <!-- Statut de sécurité -->
          <div class="card-panel">
            <div class="card-panel-head">
              <h3 class="section-title" style="font-size:17px;">Sécurité</h3>
            </div>
            <div class="security-items">
              <div class="security-item">
                <div class="sec-icon ok">
                  <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M2 6l3 3 5-5"/>
                  </svg>
                </div>
                <span class="sec-text">Session sécurisée</span>
                <span class="sec-badge ok">OK</span>
              </div>
              <div class="security-item">
                <div class="sec-icon <%= mode === 'secure' ? 'ok' : 'warn' %>">
                  <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
                    <% if (mode === 'secure') { %>
                    <path d="M2 6l3 3 5-5"/>
                    <% } else { %>
                    <path d="M6 3v4M6 8.5v.5"/>
                    <% } %>
                  </svg>
                </div>
                <span class="sec-text">Mode <%= mode %></span>
                <span class="sec-badge <%= mode === 'secure' ? 'ok' : 'warn' %>"><%= mode.toUpperCase() %></span>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div><!-- end page-body -->
  </div><!-- end main -->
</div><!-- end layout -->

<%- include('partials/footer') %>

<script>
  // Current date display
  document.getElementById('currentDate').textContent =
    new Date().toLocaleDateString('fr-FR', { weekday:'long', day:'numeric', month:'long', year:'numeric' });

  // Sample transaction data for demo
  const sampleTx = [
    { type:'credit',   beneficiary:'Salary',       note:'Monthly salary',          amount:3000.00, date:'2024-06-01' },
    { type:'debit',    beneficiary:'Marjane',       note:'Shopping at Marjane',     amount:150.75,  date:'2024-05-28' },
    { type:'transfer', beneficiary:'CIH Bank',      note:'Fees',                    amount:20.00,   date:'2024-05-20' },
    { type:'transfer', beneficiary:'Orange Maroc',  note:'Internet subscription',   amount:99.00,   date:'2024-05-15' },
  ];
  const typeLabel = { credit:'Crédit', debit:'Débit', transfer:'Virement' };
  const body = document.getElementById('txBody');
  sampleTx.forEach(tx => {
    const sign = tx.type === 'credit' ? '+' : '−';
    const dateStr = new Date(tx.date).toLocaleDateString('fr-FR', { day:'2-digit', month:'short' });
    body.insertAdjacentHTML('beforeend', `
      <tr>
        <td><span class="tx-type-badge ${tx.type}">${typeLabel[tx.type]}</span></td>
        <td>
          <div class="tx-beneficiary">${tx.beneficiary}</div>
          <div class="tx-note">${tx.note}</div>
        </td>
        <td><div class="tx-amount ${tx.type}">${sign}${tx.amount.toLocaleString('fr-FR', {minimumFractionDigits:2})} MAD</div></td>
        <td><span class="tx-date">${dateStr}</span></td>
      </tr>
    `);
  });
</script>

</body>
</html>
