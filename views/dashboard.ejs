<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tableau de bord — BankDemo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --gold:        #b8965a;
      --gold-light:  #d4b07a;
      --gold-pale:   rgba(184,150,90,0.08);
      --dark:        #0d0d0d;
      --dark-2:      #131313;
      --dark-3:      #1a1a1a;
      --dark-4:      #222222;
      --border:      rgba(255,255,255,0.07);
      --border-gold: rgba(184,150,90,0.2);
      --text:        #e8e0d4;
      --text-dim:    #7a7470;
      --text-mid:    #a09890;
      --green:       #4caf82;
      --green-bg:    rgba(76,175,130,0.1);
      --red:         #c0504a;
      --red-bg:      rgba(192,80,74,0.1);
      --sidebar-w:   260px;
    }

    html, body {
      height: 100%;
      background: var(--dark);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-weight: 300;
      font-size: 14px;
    }

    /* ══════════════════════════════════════
       LAYOUT
    ══════════════════════════════════════ */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* ══════════════════════════════════════
       SIDEBAR
    ══════════════════════════════════════ */
    .sidebar {
      width: var(--sidebar-w);
      background: var(--dark-2);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0; left: 0; bottom: 0;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-logo {
      padding: 32px 28px 28px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 36px; height: 36px;
      border: 1px solid rgba(184,150,90,0.45);
      border-radius: 2px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Cormorant Garamond', serif;
      font-size: 20px;
      color: var(--gold);
      flex-shrink: 0;
    }

    .logo-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 20px;
      font-weight: 300;
      letter-spacing: 0.06em;
    }
    .logo-text span { color: var(--gold); }

    /* Nav */
    .sidebar-nav {
      flex: 1;
      padding: 24px 0;
      overflow-y: auto;
    }

    .nav-section-label {
      font-size: 10px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-dim);
      padding: 0 28px;
      margin-bottom: 8px;
      margin-top: 20px;
    }
    .nav-section-label:first-child { margin-top: 0; }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 13px;
      padding: 11px 28px;
      color: var(--text-mid);
      text-decoration: none;
      font-size: 13.5px;
      font-weight: 300;
      position: relative;
      transition: color 0.2s, background 0.2s;
      cursor: pointer;
    }

    .nav-item svg {
      width: 16px; height: 16px;
      flex-shrink: 0;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .nav-item:hover {
      color: var(--text);
      background: rgba(255,255,255,0.03);
    }
    .nav-item:hover svg { opacity: 1; }

    .nav-item.active {
      color: var(--gold-light);
      background: var(--gold-pale);
    }
    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 2px;
      background: var(--gold);
      border-radius: 0 1px 1px 0;
    }
    .nav-item.active svg { opacity: 1; color: var(--gold); }

    /* Sidebar footer */
    .sidebar-footer {
      padding: 20px 28px;
      border-top: 1px solid var(--border);
    }

    .user-chip {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 34px; height: 34px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--gold) 0%, #7a5c2e 100%);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Cormorant Garamond', serif;
      font-size: 15px;
      color: var(--dark);
      flex-shrink: 0;
    }

    .user-info { overflow: hidden; }
    .user-email {
      font-size: 12px;
      color: var(--text-mid);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .user-role {
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--gold);
      margin-top: 2px;
    }

    .logout-btn {
      margin-left: auto;
      color: var(--text-dim);
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      transition: color 0.2s;
      flex-shrink: 0;
    }
    .logout-btn:hover { color: var(--red); }

    /* ══════════════════════════════════════
       MAIN CONTENT
    ══════════════════════════════════════ */
    .main {
      margin-left: var(--sidebar-w);
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Top bar */
    .topbar {
      background: var(--dark-2);
      border-bottom: 1px solid var(--border);
      padding: 0 40px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .topbar-left h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 22px;
      font-weight: 300;
      color: var(--text);
    }
    .topbar-left p {
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 1px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .topbar-date {
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 0.05em;
    }

    .notification-btn {
      width: 36px; height: 36px;
      border: 1px solid var(--border);
      border-radius: 50%;
      background: none;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-mid);
      cursor: pointer;
      position: relative;
      transition: border-color 0.2s, color 0.2s;
    }
    .notification-btn:hover { border-color: var(--gold); color: var(--gold-light); }
    .notification-dot {
      position: absolute;
      top: 7px; right: 7px;
      width: 6px; height: 6px;
      background: var(--gold);
      border-radius: 50%;
      border: 1.5px solid var(--dark-2);
    }

    /* Hamburger (mobile) */
    .hamburger {
      display: none;
      background: none;
      border: none;
      color: var(--text-mid);
      cursor: pointer;
      padding: 4px;
    }

    /* ══════════════════════════════════════
       PAGE BODY
    ══════════════════════════════════════ */
    .page-body {
      padding: 36px 40px 60px;
      flex: 1;
    }

    /* ── HERO BALANCE CARD ── */
    .balance-section {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 32px;
    }

    .balance-card {
      background: var(--dark-3);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 28px 32px;
      position: relative;
      overflow: hidden;
      animation: fadeUp 0.4s ease both;
    }

    .balance-card.main-card {
      grid-column: span 2;
      border-color: var(--border-gold);
      background: linear-gradient(135deg, var(--dark-3) 0%, #1c1810 100%);
    }

    .balance-card.main-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--gold), transparent);
    }

    /* Decorative ring */
    .balance-card.main-card::after {
      content: '';
      position: absolute;
      right: -40px; top: -40px;
      width: 180px; height: 180px;
      border-radius: 50%;
      border: 1px solid rgba(184,150,90,0.1);
    }

    .card-label {
      font-size: 10px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-dim);
      margin-bottom: 16px;
    }

    .card-balance {
      font-family: 'Cormorant Garamond', serif;
      font-size: 52px;
      font-weight: 300;
      color: var(--text);
      line-height: 1;
      margin-bottom: 12px;
    }
    .card-balance .currency {
      font-size: 24px;
      color: var(--gold);
      margin-right: 6px;
    }
    .card-balance .cents {
      font-size: 26px;
      color: var(--text-mid);
    }

    .card-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-dim);
    }
    .card-meta .dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--green);
      display: inline-block;
    }

    .account-number {
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }
    .account-number span {
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 0.08em;
    }
    .account-number strong {
      font-weight: 400;
      color: var(--text-mid);
      font-family: monospace;
      letter-spacing: 0.15em;
      font-size: 13px;
    }

    /* Stat cards */
    .stat-card {
      padding: 28px;
    }
    .stat-icon {
      width: 40px; height: 40px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 16px;
    }
    .stat-icon.green { background: var(--green-bg); color: var(--green); }
    .stat-icon.red   { background: var(--red-bg);   color: var(--red);   }

    .stat-value {
      font-family: 'Cormorant Garamond', serif;
      font-size: 30px;
      font-weight: 300;
      color: var(--text);
      margin-bottom: 4px;
    }
    .stat-label {
      font-size: 12px;
      color: var(--text-dim);
    }
    .stat-trend {
      margin-top: 12px;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 20px;
      display: inline-block;
    }
    .stat-trend.up   { background: var(--green-bg); color: var(--green); }
    .stat-trend.down { background: var(--red-bg);   color: var(--red);   }

    /* ── QUICK ACTIONS ── */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .section-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 20px;
      font-weight: 300;
      color: var(--text);
    }
    .section-link {
      font-size: 12px;
      color: var(--gold);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color 0.2s;
    }
    .section-link:hover { color: var(--gold-light); }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 32px;
    }

    .action-btn {
      background: var(--dark-3);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--text-mid);
      transition: border-color 0.2s, color 0.2s, background 0.2s, transform 0.15s;
      cursor: pointer;
      animation: fadeUp 0.4s ease both;
    }
    .action-btn:nth-child(1) { animation-delay: 0.05s; }
    .action-btn:nth-child(2) { animation-delay: 0.1s; }
    .action-btn:nth-child(3) { animation-delay: 0.15s; }
    .action-btn:nth-child(4) { animation-delay: 0.2s; }

    .action-btn:hover {
      border-color: var(--border-gold);
      color: var(--gold-light);
      background: var(--gold-pale);
      transform: translateY(-2px);
    }

    .action-icon {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: rgba(255,255,255,0.04);
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }
    .action-btn:hover .action-icon { background: rgba(184,150,90,0.12); color: var(--gold); }

    .action-label {
      font-size: 12px;
      text-align: center;
      line-height: 1.4;
    }

    /* ── BOTTOM GRID ── */
    .bottom-grid {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 20px;
    }

    /* Transactions table */
    .card-panel {
      background: var(--dark-3);
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
      animation: fadeUp 0.5s ease both;
      animation-delay: 0.1s;
    }

    .card-panel-head {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .tx-table {
      width: 100%;
      border-collapse: collapse;
    }

    .tx-table th {
      padding: 10px 24px;
      text-align: left;
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-dim);
      border-bottom: 1px solid var(--border);
      font-weight: 400;
    }

    .tx-table td {
      padding: 14px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      vertical-align: middle;
    }
    .tx-table tbody tr:last-child td { border-bottom: none; }

    .tx-table tbody tr {
      transition: background 0.15s;
    }
    .tx-table tbody tr:hover { background: rgba(255,255,255,0.02); }

    .tx-type-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 20px;
    }
    .tx-type-badge.credit   { background: var(--green-bg); color: var(--green); }
    .tx-type-badge.debit    { background: var(--red-bg);   color: var(--red);   }
    .tx-type-badge.transfer { background: rgba(184,150,90,0.1); color: var(--gold-light); }

    .tx-beneficiary {
      font-size: 13.5px;
      color: var(--text);
    }
    .tx-note {
      font-size: 11px;
      color: var(--text-dim);
      margin-top: 2px;
    }

    .tx-amount {
      font-family: 'Cormorant Garamond', serif;
      font-size: 17px;
      font-weight: 400;
      text-align: right;
    }
    .tx-amount.credit { color: var(--green); }
    .tx-amount.debit  { color: var(--red); }
    .tx-amount.transfer { color: var(--text-mid); }

    .tx-date {
      font-size: 11px;
      color: var(--text-dim);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-dim);
    }
    .empty-state svg { margin-bottom: 12px; opacity: 0.3; }
    .empty-state p { font-size: 13px; }

    /* ── RIGHT COLUMN ── */
    .right-col {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Progress meter */
    .progress-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
    }
    .progress-item:last-child { border-bottom: none; }

    .progress-top {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
    }
    .progress-top span:first-child { color: var(--text-mid); }
    .progress-top span:last-child  { color: var(--text); }

    .progress-bar {
      height: 3px;
      background: rgba(255,255,255,0.06);
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold) 0%, var(--gold-light) 100%);
      border-radius: 2px;
      transition: width 1s ease;
    }

    /* Security status */
    .security-items { padding: 4px 0; }
    .security-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      font-size: 12px;
    }
    .security-item:last-child { border-bottom: none; }

    .sec-icon {
      width: 28px; height: 28px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .sec-icon.ok  { background: var(--green-bg); color: var(--green); }
    .sec-icon.warn { background: rgba(230,160,50,0.12); color: #e6a032; }

    .sec-text { color: var(--text-mid); flex: 1; }
    .sec-badge { font-size: 10px; padding: 2px 7px; border-radius: 10px; }
    .sec-badge.ok   { background: var(--green-bg); color: var(--green); }
    .sec-badge.warn { background: rgba(230,160,50,0.12); color: #e6a032; }

    /* ══════════════════════════════════════
       ANIMATIONS
    ══════════════════════════════════════ */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .balance-section .balance-card:nth-child(1) { animation-delay: 0s; }
    .balance-section .balance-card:nth-child(2) { animation-delay: 0.08s; }
    .balance-section .balance-card:nth-child(3) { animation-delay: 0.14s; }

    /* Counter animation */
    .count-up { display: inline; }

    /* ══════════════════════════════════════
       RESPONSIVE
    ══════════════════════════════════════ */
    @media (max-width: 1100px) {
      .bottom-grid { grid-template-columns: 1fr; }
      .right-col { flex-direction: row; flex-wrap: wrap; }
      .right-col .card-panel { flex: 1; min-width: 280px; }
    }

    @media (max-width: 860px) {
      :root { --sidebar-w: 0px; }
      .sidebar { transform: translateX(-260px); }
      .sidebar.open { transform: translateX(0); width: 260px; }
      .main { margin-left: 0; }
      .hamburger { display: flex; }
      .balance-section { grid-template-columns: 1fr; }
      .balance-card.main-card { grid-column: span 1; }
      .actions-grid { grid-template-columns: repeat(2, 1fr); }
      .page-body { padding: 24px 20px 48px; }
      .topbar { padding: 0 20px; }
    }

    /* Overlay for mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 99;
    }
    .sidebar-overlay.show { display: block; }
  </style>
</head>
<body>

<div class="layout">

  <!-- ══════════ SIDEBAR ══════════ -->
  <aside class="sidebar" id="sidebar">

    <div class="sidebar-logo">
      <div class="logo-icon">B</div>
      <div class="logo-text">Bank</div>
    </div>

    <nav class="sidebar-nav">
      <p class="nav-section-label">Principal</p>

      <a href="/dashboard" class="nav-item active">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
          <rect x="1" y="1" width="6" height="6" rx="1"/>
          <rect x="9" y="1" width="6" height="6" rx="1"/>
          <rect x="1" y="9" width="6" height="6" rx="1"/>
          <rect x="9" y="9" width="6" height="6" rx="1"/>
        </svg>
        Tableau de bord
      </a>

      <a href="/transactions" class="nav-item">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
          <path d="M2 4h12M2 8h8M2 12h5"/>
          <path d="M13 9l2 2-2 2"/>
          <path d="M15 11h-4"/>
        </svg>
        Transactions
      </a>

      <a href="/transfer" class="nav-item">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
          <path d="M1 5h10M8 2l3 3-3 3"/>
          <path d="M15 11H5m3 3-3-3 3-3"/>
        </svg>
        Virement
      </a>

      <p class="nav-section-label">Compte</p>

      <a href="/messages" class="nav-item">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
          <rect x="1" y="3" width="14" height="10" rx="1"/>
          <path d="M1 5l7 4 7-4"/>
        </svg>
        Messages
      </a>

      <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
      <p class="nav-section-label">Administration</p>
      <a href="/admin" class="nav-item">
        <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
          <circle cx="8" cy="5" r="3"/>
          <path d="M1 14c0-3.314 3.134-6 7-6s7 2.686 7 6"/>
        </svg>
        Admin Panel
      </a>
      <% } %>
    </nav>

    <div class="sidebar-footer">
      <div class="user-chip">
        <div class="user-avatar">
          <%= typeof user !== 'undefined' && user ? user.email.charAt(0).toUpperCase() : 'U' %>
        </div>
        <div class="user-info">
          <div class="user-email">
            <%= typeof user !== 'undefined' && user ? user.email : '' %>
          </div>
          <div class="user-role">
            <%= typeof user !== 'undefined' && user ? user.role : 'user' %>
          </div>
        </div>
        <a href="/logout" class="logout-btn" title="Se déconnecter">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
            <path d="M6 2H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3"/>
            <path d="M11 11l3-3-3-3"/>
            <line x1="14" y1="8" x2="6" y2="8"/>
          </svg>
        </a>
      </div>
    </div>
  </aside>

  <!-- Mobile overlay -->
  <div class="sidebar-overlay" id="overlay" onclick="closeSidebar()"></div>

  <!-- ══════════ MAIN ══════════ -->
  <div class="main">

    <!-- Top bar -->
    <header class="topbar">
      <div style="display:flex; align-items:center; gap:16px;">
        <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="2" y1="5" x2="18" y2="5"/>
            <line x1="2" y1="10" x2="18" y2="10"/>
            <line x1="2" y1="15" x2="18" y2="15"/>
          </svg>
        </button>
        <div class="topbar-left">
          <h1>Tableau de bord</h1>
          <p>Bienvenue, <strong style="color:var(--gold-light);font-weight:400;">
            <%= typeof user !== 'undefined' && user ? user.email.split('@')[0] : 'Client' %>
          </strong></p>
        </div>
      </div>
      <div class="topbar-right">
        <span class="topbar-date" id="currentDate"></span>
        <button class="notification-btn" aria-label="Notifications">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.3">
            <path d="M8 1a5 5 0 0 1 5 5v3l1.5 2H1.5L3 9V6a5 5 0 0 1 5-5Z"/>
            <path d="M6.5 13a1.5 1.5 0 0 0 3 0"/>
          </svg>
          <span class="notification-dot"></span>
        </button>
      </div>
    </header>

    <!-- Page body -->
    <div class="page-body">

      <!-- ── BALANCE SECTION ── -->
      <div class="balance-section">

        <!-- Main balance card -->
        <div class="balance-card main-card">
          <p class="card-label">Solde disponible</p>
          <div class="card-balance">
            <span class="currency">MAD</span>
            <span class="count-up" data-target="<%= account.balance %>">
              <%= parseFloat(account.balance).toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
            </span>
          </div>
          <div class="card-meta">
            <span class="dot"></span>
            Compte actif &nbsp;·&nbsp; Mis à jour à l'instant
          </div>
          <div class="account-number">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.2" style="color:var(--text-dim)">
              <rect x="1" y="3" width="12" height="8" rx="1"/>
              <path d="M1 6h12"/>
              <path d="M4 9h2"/>
            </svg>
            <span>N° de compte</span>
            <strong>BD-<%= String(account.account_id || '0000').padStart(6,'0') %></strong>
          </div>
        </div>

        <!-- Stat: Credits -->
        <div class="balance-card stat-card" style="animation-delay:0.1s;">
          <div class="stat-icon green">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.4">
              <path d="M9 15V3M3 9l6-6 6 6"/>
            </svg>
          </div>
          <div class="stat-label">Crédits du mois</div>
          <div class="stat-value">3 000 <small style="font-size:16px;color:var(--text-dim)">MAD</small></div>
          <span class="stat-trend up">↑ Salaire reçu</span>
        </div>

      </div>

      <!-- ── QUICK ACTIONS ── -->
      <div class="section-header">
        <h2 class="section-title">Actions rapides</h2>
      </div>

      <div class="actions-grid">
        <a href="/transfer" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <path d="M2 6h12M11 2l4 4-4 4"/>
              <path d="M18 14H6M9 18l-4-4 4-4"/>
            </svg>
          </div>
          <span class="action-label">Virement</span>
        </a>

        <a href="/transactions" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <rect x="2" y="3" width="16" height="14" rx="2"/>
              <path d="M2 7h16M6 11h3M6 14h2"/>
            </svg>
          </div>
          <span class="action-label">Historique</span>
        </a>

        <a href="/messages" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <rect x="2" y="3" width="16" height="12" rx="2"/>
              <path d="M2 7l8 5 8-5"/>
            </svg>
          </div>
          <span class="action-label">Messages</span>
        </a>

        <a href="/logout" class="action-btn">
          <div class="action-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.4">
              <path d="M8 3H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h3"/>
              <path d="M14 14l4-4-4-4"/>
              <line x1="18" y1="10" x2="8" y2="10"/>
            </svg>
          </div>
          <span class="action-label">Déconnexion</span>
        </a>
      </div>

      <!-- ── BOTTOM GRID ── -->
      <div class="bottom-grid">

        <!-- Transactions récentes -->
        <div class="card-panel">
          <div class="card-panel-head">
            <h3 class="section-title" style="font-size:17px;">Dernières transactions</h3>
            <a href="/transactions" class="section-link">
              Voir tout
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M2 6h8M7 3l3 3-3 3"/>
              </svg>
            </a>
          </div>

          <table class="tx-table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Bénéficiaire</th>
                <th style="text-align:right;">Montant</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="txBody">
              <!-- Populated by JS with sample data or can be passed from server -->
            </tbody>
          </table>
        </div>

        <!-- Right column -->
        <div class="right-col">

          <!-- Utilisation du solde -->
          <div class="card-panel">
            <div class="card-panel-head">
              <h3 class="section-title" style="font-size:17px;">Aperçu du solde</h3>
            </div>
            <div class="progress-item">
              <div class="progress-top">
                <span>Dépenses estimées</span>
                <span>270 MAD</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: <%= Math.min(100, (270 / Math.max(parseFloat(account.balance), 1)) * 100).toFixed(1) %>%"></div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-top">
                <span>Virements effectués</span>
                <span>119 MAD</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: <%= Math.min(100, (119 / Math.max(parseFloat(account.balance), 1)) * 100).toFixed(1) %>%; background: linear-gradient(90deg, #c0504a, #e07a76);"></div>
              </div>
            </div>
            <div class="progress-item" style="border-bottom:none;">
              <div class="progress-top">
                <span>Solde disponible</span>
                <span style="color:var(--gold);">
                  <%= parseFloat(account.balance).toLocaleString('fr-FR', {minimumFractionDigits:2}) %> MAD
                </span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:100%; background: linear-gradient(90deg, var(--gold), var(--gold-light));"></div>
              </div>
            </div>
          </div>

          <!-- Sécurité -->
          <div class="card-panel">
            <div class="card-panel-head">
              <h3 class="section-title" style="font-size:17px;">Sécurité du compte</h3>
            </div>
            <div class="security-items">
              <div class="security-item">
                <div class="sec-icon ok">
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M2 6.5l3.5 3.5L11 3"/>
                  </svg>
                </div>
                <span class="sec-text">Mot de passe sécurisé</span>
                <span class="sec-badge ok">OK</span>
              </div>
              <div class="security-item">
                <div class="sec-icon ok">
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M2 6.5l3.5 3.5L11 3"/>
                  </svg>
                </div>
                <span class="sec-text">Session chiffrée (HTTPS)</span>
                <span class="sec-badge ok">OK</span>
              </div>
              <div class="security-item" style="border-bottom:none;">
                <div class="sec-icon warn">
                  <svg width="13" height="13" viewBox="0 0 13 13" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M6.5 1L12 11H1L6.5 1Z"/>
                    <line x1="6.5" y1="5" x2="6.5" y2="8"/>
                    <circle cx="6.5" cy="9.5" r="0.5" fill="currentColor"/>
                  </svg>
                </div>
                <span class="sec-text">2FA non activée</span>
                <span class="sec-badge warn">Recommandé</span>
              </div>
            </div>
          </div>

        </div>
      </div>
      <!-- end bottom-grid -->

    </div>
    <!-- end page-body -->

  </div>
  <!-- end main -->

</div>

<script>
  // ── Date display
  (function() {
    const el = document.getElementById('currentDate');
    const now = new Date();
    const opts = { weekday:'long', day:'numeric', month:'long', year:'numeric' };
    el.textContent = now.toLocaleDateString('fr-FR', opts);
  })();

  // ── Sample transactions (in production, pass from server via EJS)
  const sampleTx = [
    { type: 'credit',   beneficiary: 'Salary',       note: 'Salaire mensuel',       amount: 3000.00, date: '2025-01-31' },
    { type: 'debit',    beneficiary: 'Marjane',       note: 'Courses alimentaires',  amount: 150.75,  date: '2025-01-28' },
    { type: 'transfer', beneficiary: 'CIH Bank',      note: 'Frais bancaires',       amount: 20.00,   date: '2025-01-25' },
    { type: 'transfer', beneficiary: 'Orange Maroc',  note: 'Abonnement Internet',   amount: 99.00,   date: '2025-01-20' },
  ];

  const typeLabel = { credit: 'Crédit', debit: 'Débit', transfer: 'Virement' };

  const body = document.getElementById('txBody');
  if (body) {
    if (sampleTx.length === 0) {
      body.innerHTML = `<tr><td colspan="4"><div class="empty-state">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="1.2"><rect x="4" y="6" width="24" height="20" rx="2"/><path d="M4 12h24M10 17h4M10 21h2"/></svg>
        <p>Aucune transaction récente</p>
      </div></td></tr>`;
    } else {
      sampleTx.forEach(tx => {
        const sign = tx.type === 'credit' ? '+' : '-';
        const dateStr = new Date(tx.date).toLocaleDateString('fr-FR', { day:'2-digit', month:'short' });
        body.insertAdjacentHTML('beforeend', `
          <tr>
            <td><span class="tx-type-badge ${tx.type}">${typeLabel[tx.type]}</span></td>
            <td>
              <div class="tx-beneficiary">${tx.beneficiary}</div>
              <div class="tx-note">${tx.note}</div>
            </td>
            <td><div class="tx-amount ${tx.type}">${sign}${tx.amount.toLocaleString('fr-FR', {minimumFractionDigits:2})} MAD</div></td>
            <td><span class="tx-date">${dateStr}</span></td>
          </tr>
        `);
      });
    }
  }

  // ── Mobile sidebar toggle
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('show');
  }
  function closeSidebar() {
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('overlay').classList.remove('show');
  }
</script>

</body>
</html>
